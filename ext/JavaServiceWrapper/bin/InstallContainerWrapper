# Copyright (c) 1999, 2006 Tanuki Software Inc.
#
# Script to generate a script suitable for installing container as a daemon in init.d
#

_ICW_GENII_INSTALL_DIR="%{INSTALL_PATH}"
_ICW_LOCAL_JAVA_DIR="$_ICW_GENII_INSTALL_DIR/Java/linux-i586/jre"

# get user's data directory...
_GENII_USER_DIR=`"$_ICW_GENII_INSTALL_DIR/grid" GetUserDir`
echo "_GENII_USER_DIR is now set to ....     $_GENII_USER_DIR"

_CONTAINER_DIR="$_GENII_USER_DIR"

# create directory to store container data...
echo "Creating directory for container: $_CONTAINER_DIR."
mkdir -p "$_CONTAINER_DIR"

#
# create script for init.d to manage this container
#
_MANAGE_CONTAINER_SCRIPT_PATH="$_ICW_GENII_INSTALL_DIR/GenesisII-manage-script"
echo "#!/bin/sh" > "$_MANAGE_CONTAINER_SCRIPT_PATH"
echo "# To enable auto start of container daemon, add this script to /etc/init.d and the proper /etc/rcX.d directories" >> "$_MANAGE_CONTAINER_SCRIPT_PATH"
echo "#" >> "$_MANAGE_CONTAINER_SCRIPT_PATH"
echo "" >> "$_MANAGE_CONTAINER_SCRIPT_PATH"
echo "GENII_INSTALL_DIR=\"$_ICW_GENII_INSTALL_DIR\" LOCAL_JAVA_DIR=\"$_ICW_LOCAL_JAVA_DIR\" GENII_USER_DIR=\"$_CONTAINER_DIR\" \"$_ICW_GENII_INSTALL_DIR/VCGRContainerDaemon\" \"\$1\"" >> "$_MANAGE_CONTAINER_SCRIPT_PATH"
chmod 744 "$_MANAGE_CONTAINER_SCRIPT_PATH"

echo "You should start the container process by running $_MANAGE_CONTAINER_SCRIPT_PATH" start
exit 0

#
# Start container on console...
#
_CONTAINER_OUTPUT_PATH="$_CONTAINER_DIR/container.out"
echo ""
echo "Starting container manually with output piped to file $_CONTAINER_OUTPUT_PATH ..."
echo ""

"$_MANAGE_CONTAINER_SCRIPT_PATH" start > "$_CONTAINER_OUTPUT_PATH" 2>&1 &
