<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="scripts" name="GenesisII.scripts">

	<target name="build-script-win" if="windows.scripts">
		<copy file="${win-script-src-dir}/${win-script-base-name}.bat"
			tofile="${basedir}/${win-script-base-name}.bat"/>
		<replace file="${basedir}/${win-script-base-name}.bat"
			token="$INSTALL_PATH" value="${basedir}" summary="no"/>
		<replace file="${basedir}/${win-script-base-name}.bat"
			token="$LOG4JCONFIG" value="genesisII.log4j.properties"
			summary="no"/>
	</target>

	<target name="build-script-unix" if="unix.scripts">
		<copy file="${unix-script-src-dir}/${unix-script-base-name}"
			tofile="${basedir}/${unix-script-base-name}"/>
		<replace file="${basedir}/${unix-script-base-name}"
			token="%{INSTALL_PATH}" value="${basedir}" summary="no"/>
		<replace file="${basedir}/${unix-script-base-name}"
			token="%{LOG4JCONFIG}" value="genesisII.log4j.properties"
			summary="no"/>
		<chmod file="${basedir}/${unix-script-base-name}" perm="755"/>
	</target>

	<target name="build-script">
		<antcall target="build-script-win">
			<param name="win-script-src-dir" value="${script-src-dir}"/>
			<param name="win-script-base-name" value="${script-base-name}"/>
		</antcall>
		<antcall target="build-script-unix">
			<param name="unix-script-src-dir" value="${script-src-dir}"/>
			<param name="unix-script-base-name" value="${script-base-name}"/>
		</antcall>
	</target>
	
	<target name="clean-all-scripts">
		<delete quiet="true">
			<fileset dir="${basedir}">
				<include name="jserver.*"/>
				<include name="jserver-debug.*"/>
				<include name="runContainer.*"/>
				<include name="grid*"/>
				<include name="simple-command*"/>
				<include name="cert-tool*"/>
				<include name="initialize-new-net-security*"/>
				<include name="install-new-container*"/>
				<include name="connect-new-client*"/>
				<include name="uninstall-container*"/>
				<include name="InstallContainerWrapper*"/>
				<include name="UninstallContainerWrapper*"/>
				<include name="windows-start-wrapper.bat"/>
				<include name="windows-cmd-runner.bat"/>
				<include name="VCGRContainerDaemon"/>
				<include name="linux-cmd-wrapper"/>
			</fileset>
		</delete>
	</target>
		
	<target name="scripts">
		<condition property="unix.scripts">
			<os family="unix"/>
		</condition>
		<condition property="windows.scripts">
			<os family="windows"/>
		</condition>

		<copy file="${scripts.dir}/jar-desc.xml"
			tofile="${basedir}/jar-desc.xml"/>
		<replace file="${basedir}/jar-desc.xml"
			token="$INSTALL_PATH" value="${basedir}" summary="no"/>

		<copy file="${scripts.dir}/genii-base-application.properties"
			tofile="${basedir}/ApplicationWatcher/genii-base-application.properties"/>
		<replace file="${basedir}/ApplicationWatcher/genii-base-application.properties"
			token="$INSTALL_PATH" value="${basedir}" summary="no"/>

		<copy file="${scripts.dir}/genii-container-application.properties"
			tofile="${basedir}/ApplicationWatcher/genii-container-application.properties"/>
		<replace file="${basedir}/ApplicationWatcher/genii-container-application.properties"
			token="$INSTALL_PATH" value="${basedir}" summary="no"/>

		<copy file="${scripts.dir}/genii-client-application.properties"
			tofile="${basedir}/ApplicationWatcher/genii-client-application.properties"/>
		<replace file="${basedir}/ApplicationWatcher/genii-client-application.properties"
			token="$INSTALL_PATH" value="${basedir}" summary="no"/>

		<copy file="${scripts.dir}/genii-simple-application.properties"
			tofile="${basedir}/ApplicationWatcher/genii-simple-application.properties"/>
		<replace file="${basedir}/ApplicationWatcher/genii-simple-application.properties"
			token="$INSTALL_PATH" value="${basedir}" summary="no"/>

		<copy file="${scripts.dir}/genii-certtool-application.properties"
			tofile="${basedir}/ApplicationWatcher/genii-certtool-application.properties"/>
		<replace file="${basedir}/ApplicationWatcher/genii-certtool-application.properties"
			token="$INSTALL_PATH" value="${basedir}" summary="no"/>

		<copy file="${scripts.dir}/genii-ogrshserv-application.properties"
			tofile="${basedir}/ApplicationWatcher/genii-ogrshserv-application.properties"/>
		<replace file="${basedir}/ApplicationWatcher/genii-ogrshserv-application.properties"
			token="$INSTALL_PATH" value="${basedir}" summary="no"/>

		<copy file="${scripts.dir}/jserver-jar-desc.xml"
			tofile="${basedir}/jserver-jar-desc.xml"/>
		<replace file="${basedir}/jserver-jar-desc.xml"
			token="$INSTALL_PATH" value="${basedir}" summary="no"/>
		<replace file="${basedir}/jserver-jar-desc.xml"
			token="$LOG4JCONFIG" value="genesisII.log4j.properties"
			summary="no"/>

		<antcall target="build-script-win">
			<param name="win-script-src-dir" value="${scripts.dir}"/>
			<param name="win-script-base-name" value="runContainer"/>
		</antcall>
		<antcall target="build-script-unix">
			<param name="unix-script-src-dir" value="${scripts.dir}"/>
			<param name="unix-script-base-name" value="runContainer.sh"/>
		</antcall>
		<antcall target="build-script-unix">
			<param name="unix-script-src-dir" value="${scripts.dir}"/>
			<param name="unix-script-base-name" value="jserver.sh"/>
		</antcall>
		<antcall target="build-script-unix">
			<param name="unix-script-src-dir" value="${scripts.dir}"/>
			<param name="unix-script-base-name" value="jserver-debug.sh"/>
		</antcall>
		<antcall target="build-script">
			<param name="script-src-dir" value="${scripts.dir}"/>
			<param name="script-base-name" value="grid"/>
		</antcall>
		<antcall target="build-script">
			<param name="script-src-dir" value="${scripts.dir}"/>
			<param name="script-base-name" value="simple-command"/>
		</antcall>
		<antcall target="build-script">
			<param name="script-src-dir" value="${scripts.dir}"/>
			<param name="script-base-name" value="cert-tool"/>
		</antcall>
		<antcall target="build-script">
			<param name="script-src-dir" value="${scripts.dir}"/>
			<param name="script-base-name" value="initialize-new-net-security"/>
		</antcall>
		<antcall target="build-script">
			<param name="script-src-dir" value="${scripts.dir}"/>
			<param name="script-base-name" value="install-new-container"/>
		</antcall>
		<antcall target="build-script">
			<param name="script-src-dir" value="${scripts.dir}"/>
			<param name="script-base-name" value="connect-new-client"/>
		</antcall>
		<antcall target="build-script">
			<param name="script-src-dir" value="${scripts.dir}"/>
			<param name="script-base-name" value="uninstall-container"/>
		</antcall>
		<antcall target="build-script">
			<param name="script-src-dir" value="${basedir}/ext/JavaServiceWrapper/bin"/>
			<param name="script-base-name" value="InstallContainerWrapper"/>
		</antcall>
		<antcall target="build-script">
			<param name="script-src-dir" value="${basedir}/ext/JavaServiceWrapper/bin"/>
			<param name="script-base-name" value="UninstallContainerWrapper"/>
		</antcall>
		<antcall target="build-script-win">
			<param name="win-script-src-dir" value="${scripts.dir}"/>
			<param name="win-script-base-name" value="windows-start-wrapper"/>
		</antcall>
		<antcall target="build-script-win">
			<param name="win-script-src-dir" value="${scripts.dir}"/>
			<param name="win-script-base-name" value="windows-cmd-runner"/>
		</antcall>
		<antcall target="build-script-unix">
			<param name="unix-script-src-dir" value="${scripts.dir}"/>
			<param name="unix-script-base-name" value="VCGRContainerDaemon"/>
		</antcall>
		<antcall target="build-script-unix">
			<param name="unix-script-src-dir" value="${scripts.dir}"/>
			<param name="unix-script-base-name" value="linux-cmd-wrapper"/>
		</antcall>
	</target>

</project>
